# LIKE operator and patterns

metadata:
  version: "1.0"
  description: "Pattern matching with % and _"

setup: []

test_cases:
  - name: "Prefix match"
    sql: "SELECT 'alpha' LIKE 'a%' AS r"
    expect:
      rows: 1
      data:
        - r: true

  - name: "LIKE is case-insensitive (MySQL default)"
    sql: "SELECT 'Alpha' LIKE 'a%' AS r"
    expect:
      rows: 1
      data:
        - r: true

  - name: "LIKE respects binary collation (case-sensitive)"
    sql: "SELECT 'Alpha' COLLATE utf8mb4_bin LIKE 'a%' AS r"
    expect:
      rows: 1
      data:
        - r: false

  - name: "= is case-insensitive (MySQL default)"
    sql: "SELECT 'Alpha' = 'alpha' AS r"
    expect:
      rows: 1
      data:
        - r: true

  - name: "<> is case-insensitive (MySQL default)"
    sql: "SELECT 'Alpha' <> 'alpha' AS r"
    expect:
      rows: 1
      data:
        - r: false

  - name: "= respects binary collation (case-sensitive)"
    sql: "SELECT 'Alpha' COLLATE utf8mb4_bin = 'alpha' AS r"
    expect:
      rows: 1
      data:
        - r: false

  - name: "<> respects binary collation (case-sensitive)"
    sql: "SELECT 'Alpha' COLLATE utf8mb4_bin <> 'alpha' AS r"
    expect:
      rows: 1
      data:
        - r: true

  - name: "Single-char match"
    sql: "SELECT 'a1' LIKE 'a_' AS r"
    expect:
      rows: 1
      data:
        - r: true

  - name: "No match"
    sql: "SELECT 'beta' LIKE 'a%' AS r"
    expect:
      rows: 1
      data:
        - r: false

  # --- NOT LIKE ---
  - name: "Create NOT LIKE test table"
    sql: "CREATE TABLE notlike_test (id INT PRIMARY KEY, name VARCHAR(50))"

  - name: "Insert NOT LIKE test data"
    sql: |
      INSERT INTO notlike_test (id, name) VALUES
        (1, 'Brand#23'), (2, 'Brand#45'), (3, 'Generic'),
        (4, 'Brand#12'), (5, 'NoName'), (6, 'Brand#99'),
        (7, 'Special'), (8, 'Brand#23')

  - name: "NOT LIKE basic"
    sql: "SELECT id FROM notlike_test WHERE name NOT LIKE 'Brand%' ORDER BY id"
    expect:
      rows: 3
      data:
        - id: 3
        - id: 5
        - id: 7

  - name: "NOT LIKE with underscore wildcard"
    sql: "SELECT id FROM notlike_test WHERE name NOT LIKE 'Brand#__' ORDER BY id"
    expect:
      rows: 3
      data:
        - id: 3
        - id: 5
        - id: 7

cleanup:
  - sql: "DROP TABLE IF EXISTS notlike_test"
