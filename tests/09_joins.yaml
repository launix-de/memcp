# Minimal Table Operations Test - JOIN Version
# Testing just the most basic operations to isolate database corruption issue
# Includes JOIN operations

metadata:
  version: "1.0"
  description: "Minimal table operations test for debugging, including JOINs"

setup:
  - name: "Clean up test tables"
    sql: "DROP TABLE IF EXISTS simple_test"
  - name: "Clean up test tables"
    sql: "DROP TABLE IF EXISTS related_data"
  - name: "init 1"
    sql: "CREATE TABLE simple_test (id INT, name VARCHAR(50))"
  - name: "init2"
    sql: "CREATE TABLE related_data (id INT, simple_test_id INT, description VARCHAR(100))"
  - name: "init3"
    sql: "INSERT INTO simple_test (id, name) VALUES (1, 'test'), (2, 'another')"

test_cases:
  - name: "Simple INSERT"
    sql: "INSERT INTO related_data (id, simple_test_id, description) VALUES (101, 1, 'Description for test'), (102, 2, 'Another description')"
    expect:
      affected_rows: 2 #Should be two inserts

  - name: "SELECT simple test"
    sql: "SELECT * FROM related_data WHERE simple_test_id = 1"
    expect:
      rows: 1 # Should return the row where simple_test_id is 1

  - name: "SELECT JOIN test with multiple records"
    sql: "SELECT s.name, r.description FROM simple_test s JOIN related_data r ON s.id = r.simple_test_id WHERE s.id = 1"
    expect:
      rows: 1
      expected_results:
        - name: 'test'
          description: 'Description for test'


#  - name: "Complex SELECT JOIN test with filtering"
#    sql: "SELECT s.name, r.description FROM simple_test s JOIN related_data r ON s.id = r.simple_test_id WHERE s.id IN (1, 2) AND r.description LIKE '%description%'"
#    expect:
#      rows: 2 # Should return rows where id is 1 or 2 AND description contains "description"
#      expected_results:
#        - name: 'test'
#          description: 'Description for test'
#        - name: 'another'
#          description: 'Another description'
#
#  - name: "SELECT JOIN with COUNT"
#    sql: "SELECT COUNT(*) FROM simple_test s JOIN related_data r ON s.id = r.simple_test_id"
#    expect:
#      result: 2  #Should return the number of records related to simple_test
#
#  - name: "SELECT JOIN with DISTINCT"
#    sql: "SELECT DISTINCT r.description FROM simple_test s JOIN related_data r ON s.id = r.simple_test_id"
#    expect:
#      rows: 2
#      exptected_results:
#        - description: "Description for test"
#        - description: "Another description"
#
