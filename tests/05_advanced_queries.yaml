# Advanced Query Test Suite
# Complex queries, JOINs, subqueries, GROUP BY, aggregates (many marked TODO until supported)

metadata:
  version: "1.0"
  description: "Advanced SQL queries and aggregation features"

setup:
  - action: "CREATE TABLE adv_customers"
    sql: |
      CREATE TABLE adv_customers (
        id INT,
        name VARCHAR(100),
        city VARCHAR(50),
        country VARCHAR(50)
      )
  - action: "CREATE TABLE adv_orders"
    sql: |
      CREATE TABLE adv_orders (
        id INT,
        customer_id INT,
        amount DECIMAL(10,2),
        order_date VARCHAR(20),
        status VARCHAR(20)
      )
  - action: "CREATE TABLE products"
    sql: |
      CREATE TABLE products (
        id INT,
        name VARCHAR(100),
        category VARCHAR(50),
        price DECIMAL(10,2)
      )

test_cases:

  # === SETUP TEST DATA ===
  - name: "Insert customer test data"
    sql: |
      INSERT INTO adv_customers (id, name, city, country) VALUES
      (1, 'John Doe', 'New York', 'USA'),
      (2, 'Jane Smith', 'London', 'UK'),
      (3, 'Hans Mueller', 'Berlin', 'Germany'),
      (4, 'Marie Dupont', 'Paris', 'France'),
      (5, 'Carlos Rodriguez', 'Madrid', 'Spain')
    expect:
      affected_rows: 5

  - name: "Insert order test data"
    sql: |
      INSERT INTO adv_orders (id, customer_id, amount, order_date, status) VALUES
      (1, 1, 299.99, '2024-01-15', 'completed'),
      (2, 2, 150.00, '2024-02-01', 'completed'),
      (3, 3, 500.00, '2024-01-20', 'pending'),
      (4, 4, 75.50, '2024-02-10', 'completed'),
      (5, 5, 1200.00, '2024-02-15', 'shipped')
    expect:
      affected_rows: 5

  - name: "Insert product test data"
    sql: |
      INSERT INTO products (id, name, category, price) VALUES
      (1, 'Laptop', 'Electronics', 999.99),
      (2, 'Mouse', 'Electronics', 25.99),
      (3, 'Keyboard', 'Electronics', 79.99),
      (4, 'Chair', 'Furniture', 199.99),
      (5, 'Desk', 'Furniture', 299.99)
    expect:
      affected_rows: 5

  # === BASIC VERIFICATION ===  
  - name: "Simple COUNT verification"
    sql: "SELECT * FROM adv_customers"
    expect: {}

  # === WORKING FEATURES VERIFICATION ===
  - name: "Verify all customer data inserted correctly"
    sql: "SELECT * FROM adv_customers WHERE id = 1"
    expect: {}

cleanup:
  - action: "Clean up adv_customers table"
    sql: "DROP TABLE IF EXISTS adv_customers"
  - action: "Clean up adv_orders table" 
    sql: "DROP TABLE IF EXISTS adv_orders"
  - action: "Clean up products table"
    sql: "DROP TABLE IF EXISTS products"