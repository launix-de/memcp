# MySQL Compatibility v1 â€” AUTO_INCREMENT, LAST_INSERT_ID, UPSERT

metadata:
  version: "1.0"
  description: "MySQL v1: autoincrement, last_insert_id(), upsert"
  noncritical: true

setup: []

test_cases:
  - name: "CREATE TABLE with AUTO_INCREMENT PK"
    sql: "CREATE TABLE ai (id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50))"
    expect:
      affected_rows: 1

  - name: "INSERT without id assigns AUTO_INCREMENT"
    sql: "INSERT INTO ai (name) VALUES ('a')"
    expect:
      affected_rows: 1

  - name: "Fetch LAST_INSERT_ID()"
    sql: "SELECT LAST_INSERT_ID() AS lid"
    expect:
      rows: 1
      data:
        - lid: 1

  - name: "ON DUPLICATE KEY UPDATE updates existing row"
    sql: "INSERT INTO ai (id, name) VALUES (1, 'b') ON DUPLICATE KEY UPDATE name = VALUES(name)"
    expect: {}

  - name: "Verify updated value"
    sql: "SELECT name FROM ai WHERE id = 1"
    expect:
      rows: 1
      data:
        - name: "b"

cleanup: []

